@model UsersApp.ViewModels.QuizDetailsViewModel

@{
    ViewData["Title"] = "Take Quiz";
    Layout = "~/Views/Shared/_HomeLayout.cshtml";
}

<html>
<head>
    <link rel="stylesheet" href="~/css/Global/Header.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/TakeQuiz.css" asp-append-version="true" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            let timers = @Html.Raw(Json.Serialize(Model.Timer));
            let currentQuestionIndex = 0;
            let timer;

            function showQuestion(index) {
                if (index >= Object.keys(timers).length) {
                    $('#quiz-container').html('<strong>Quiz Completed!</strong>');
                    return;
                }

                $('#question').text(Model.Questions[index + 1]);
                $('#choices').empty();
                Model.Choices[index + 1].forEach((choice, i) => {
                    $('#choices').append(`<button class="choice">${choice}</button>`);
                });

                startTimer(timers[index + 1]);
            }

            function startTimer(minutes) {
                clearInterval(timer);
                let timeLeft = minutes * 60;
                timer = setInterval(() => {
                    timeLeft--;
                    let minutes = Math.floor(timeLeft / 60);
                    let seconds = timeLeft % 60;
                    $('#timer').text(`Time left: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`);
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        showQuestion(++currentQuestionIndex);
                    }
                }, 1000);
            }

            showQuestion(currentQuestionIndex);
        });
    </script>
</head>
<body>
    <div id="quiz-container">
        <div id="timer"></div>
        <div id="question"></div>
        <div id="choices"></div>
    </div>
</body>
</html>